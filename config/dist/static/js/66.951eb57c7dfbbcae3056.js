webpackJsonp([66],{3333:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("GRVU"),s=(a("YkBq"),a("oFuF")),i={data:function(){return{startDate:Object(s.b)(-7),endDate:Object(s.b)(0),tableData:[],tasklogDetailVisible:!1,value:"",ydztValue:"",fwValue:"",baseUrl:"",isRead:"",taskDetail:{},pzValue:"",logDetail:{},isedit:!0,pzList:[],isJzuser:"",paramsData:{},xmmc:""}},mounted:function(){this.isJzuser=sessionStorage.getItem("isJZuser"),this.baseUrl=window.baseurl,this.xmmc=this.$route.query.xmmc,this.paramsData=this.$route.query,delete this.paramsData.xmmc,this.getPersonalWorkLog(this.paramsData)},methods:{handleReadlog:function(t,e){var a=this;0==e.ydzt&&Object(l.l)({wid:e.wid}).then(function(t){var l=t.data;"success"==l.state?e.ydzt=1:a.$alert(l.msg,"提示",{confirmButtonText:"确定",type:"error"})})},handleCloseDetail:function(){this.tasklogDetailVisible=!1},handleSaveDetail:function(){var t=this;Object(l.c)({wid:this.taskDetail.wid,bz:this.pzValue}).then(function(e){"success"==e.data.state&&(t.tasklogDetailVisible=!1,t.$alert("保存成功","提示",{confirmButtonText:"确定",type:"success"}))})},handleTasklogDetail:function(t,e){this.tasklogDetailVisible=!0,this.taskDetail=e,0==e.ydzt&&Object(l.l)({wid:e.wid}).then(function(t){"success"==t.data.state&&(e.ydzt=1)}),2!=e.ydzt&&0!=this.isJzuser||this.getLogComments(this.taskDetail.wid),this.getLogComment(this.taskDetail.wid)},handleDownFile:function(t,e,a){var l=a.target.getAttribute("data-fj");window.open(window.baseurl+"attachment/downloadFile.do?fjId="+l)},handleDeleteDetail:function(t,e){var a=this;this.$confirm("是否删除该条日志?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(l.d)({wid:e.wid}).then(function(t){"success"==t.data.state&&a.$alert("删除成功","提示",{confirmButtonText:"确定",type:"success"})})}).catch(function(){})},getLogComment:function(t){var e=this;Object(l.f)({wid:t}).then(function(t){var a=t.data;"success"==a.state&&(e.pzValue=a.data)})},getLogComments:function(t){var e=this;Object(l.g)({wid:t}).then(function(t){var a=t.data;"success"==a.state&&(null!=a.data&&0!=a.data.length?e.pzList=a.data:e.pzList=[])})},getPersonalWorkLog:function(t){var e=this;this.$get(this.API.getPersonalWorkLog,t).then(function(t){"success"==t.state&&(null!=t.data?e.tableData=t.data:e.tableData=[])})}},activated:function(){},components:{}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-log"},[a("div",{staticClass:"task-log-tabel"},[t.$route.query.xmbh?a("div",[a("h4",[t._v("【"+t._s(t.$route.query.xmbh)+"】　"+t._s(t.xmmc))])]):t._e(),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[t.$route.query.xmbh?t._e():a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{flex:"",spacearound:""}},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){t.handleTasklogDetail(e.$index,e.row)}}},[t._v("批注")]),t._v(" "),e.row.editable?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){t.handleEditDetail(e.$index,e.row)}}},[t._v("编辑")]):t._e(),t._v(" "),e.row.editable?a("el-button",{staticStyle:{color:"#f00"},attrs:{type:"text",size:"mini"},on:{click:function(a){t.handleDeleteDetail(e.$index,e.row)}}},[t._v("删除")]):t._e()],1)]}}])}),t._v(" "),t.$route.query.xmbh?t._e():a("el-table-column",{attrs:{label:"阅读状态",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{slot:"reference"},slot:"reference"},[0==e.row.ydzt?a("span",{staticClass:"tasklog-ydzt tasklog-ydzt-wy",attrs:{title:"点击设为已阅"},on:{click:function(a){t.handleReadlog(e.$index,e.row)}}},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.row.ydzt_display)+"\n\t\t\t\t\t\t")]):t._e(),t._v(" "),0!=e.row.ydzt?a("span",{class:{"tasklog-ydzt":!0,"tasklog-ydzt-yy":1==e.row.ydzt}},[t._v("\n\t\t\t\t\t\t\t"+t._s(1==e.row.ydzt?"已阅":e.row.ydzt_display)+"\n\t\t\t\t\t\t")]):t._e()])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"cjrxm",label:"填写人",width:"90"}}),t._v(" "),t.$route.query.xmbh?t._e():a("el-table-column",{attrs:{prop:"xmbh",label:"项目编号","show-overflow-tooltip":"",sortable:"",width:"110"}}),t._v(" "),t.$route.query.xmbh?t._e():a("el-table-column",{attrs:{prop:"xmmc",label:"项目名称","show-overflow-tooltip":"","min-width":"220"}}),t._v(" "),a("el-table-column",{attrs:{prop:"gcms",label:"内容","show-overflow-tooltip":"","min-width":"300"}}),t._v(" "),a("el-table-column",{attrs:{prop:"cpmc_display",label:"产品名称","show-overflow-tooltip":"","min-width":"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"rwmc_display",label:"任务名称","show-overflow-tooltip":"","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"gcrq",label:"日报日期",width:"110",sortable:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"cjsj",label:"填写时间",width:"160",sortable:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"gs",label:"工时(小时)",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{label:"附件"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("div",{on:{click:function(a){t.handleDownFile(e.$index,e.row,a)}}},t._l(e.row.fjData,function(e,l){return a("span",{key:l,attrs:{title:"点击下载","data-fj":e.fjbh}},[t._v(t._s(e.fjmc))])}))])]}}])})],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.tasklogDetailVisible,title:"日志详情",width:"650px","close-on-click-modal":!1},on:{"update:visible":function(e){t.tasklogDetailVisible=e}}},[a("div",{staticClass:"tasklog-detail"},[a("p",[a("span",[t._v("日志日期 :")]),t._v(" "),a("span",[t._v(t._s(t.taskDetail.gcrq))])]),t._v(" "),a("p",[a("span",[t._v("项目名称 :")]),t._v(" "),a("span",[t._v(t._s(""==t.taskDetail.xmmc?"无":t.taskDetail.xmmc))])]),t._v(" "),a("p",[a("span",[t._v("产品名称 :")]),t._v(" "),a("span",[t._v(t._s(""==t.taskDetail.cpmc_display?"无":t.taskDetail.cpmc_display))])]),t._v(" "),a("p",[a("span",[t._v("关联任务 :")]),t._v(" "),a("span",[t._v(t._s(""==t.taskDetail.rwmc_display?"无":t.taskDetail.rwmc_display))])]),t._v(" "),a("p",[a("span",[t._v("工时(小时) :")]),t._v(" "),a("span",[t._v(t._s(t.taskDetail.gs))])]),t._v(" "),a("p",[a("span",[t._v("日志内容 :")]),t._v(" "),a("span",[t._v(t._s(t.taskDetail.gcms))])]),t._v(" "),a("p",[a("span",[t._v("附件列表 :")]),t._v(" "),a("span",{staticClass:"name-wrapper"},t._l(t.taskDetail.fjData,function(e,l){return a("span",{key:l,attrs:{"data-fj":e.fjbh},on:{click:function(e){t.handleDownFile("","",e)}}},[t._v(t._s(e.fjmc))])}))]),t._v(" "),2==t.taskDetail.ydzt||0==t.isJzuser?a("p",{staticStyle:{border:"none"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.pzList,border:"","max-height":"300"}},[a("el-table-column",{attrs:{prop:"yhxm",label:"姓名",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ydsj",label:"阅读日期",width:"155"}}),t._v(" "),a("el-table-column",{attrs:{prop:"bz",label:"批注","show-overflow-tooltip":""}})],1)],1):t._e(),t._v(" "),2!=t.taskDetail.ydzt?a("p",{staticStyle:{border:"none"},attrs:{flex:""}},[a("span",[t._v("批注:")]),t._v(" "),a("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入批注内容",resize:"none"},model:{value:t.pzValue,callback:function(e){t.pzValue=e},expression:"pzValue"}})],1):t._e(),t._v(" "),a("div",{staticStyle:{"text-align":"right"}},[2!=t.taskDetail.ydzt?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.handleSaveDetail}},[t._v("更新批注")]):t._e(),t._v(" "),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:t.handleCloseDetail}},[t._v("取消")])],1)])])],1)},staticRenderFns:[]};var o=a("Z0/y")(i,n,!1,function(t){a("Elde")},"data-v-b2fed65c",null);e.default=o.exports},Elde:function(t,e){}});
//# sourceMappingURL=66.951eb57c7dfbbcae3056.js.map