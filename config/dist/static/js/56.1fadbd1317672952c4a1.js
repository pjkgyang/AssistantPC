webpackJsonp([56],{"1+WS":function(t,e){},"4Y1v":function(t,e){},S8Yc:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("8MYY"),a=i("P+gh"),l=(i("1bZv"),i("orx7")),r=i("W9dc"),o=i("rphB"),n=(i("mtWM"),i("mw3O"),{data:function(){return{isJZuser:0,dialogVisible:!1,visible:this.show,form:{cljg:"",sfcl:1,fileList:"",gs:""},wtList:[],total:0,currentPage:1,pageSize:6,wtData:{}}},methods:{handleClose:function(){this.visible=!1},handleCommitwtdj:function(t){this.wtData=t,1!=t.zt?this.dialogVisible=!this.dialogVisible:this.$message({message:"该风险已处理，无需处理~",type:"warning"})},handleSizeChange:function(t){this.pageSize=t,this.currentPage=1,this.pageActiveServiceProblem()},handleCurrentChange:function(t){this.currentPage=t,this.pageActiveServiceProblem()},handleCommit:function(){this.validate()&&this.submitActiveServiceProblem()},submitActiveServiceProblem:function(){var t=this;this.$post(this.API.submitActiveServiceProblem,{wid:this.wtData.wid,cljg:this.form.cljg,zt:this.form.sfcl,gs:this.form.gs}).then(function(e){"success"==e.state?(t.$message({message:"提交成功~",type:"success"}),t.pageActiveServiceProblem(),t.dialogVisible=!t.dialogVisible):t.$alert(e.msg,"提示",{confirmButtonText:"确定",type:"error"})})},pageActiveServiceProblem:function(){var t=this;this.$get(this.API.pageActiveServiceProblem,{curPage:this.currentPage,pageSize:this.pageSize,cpbh:this.rowData.cpbh,zbwid:this.rowData.wid}).then(function(e){"success"==e.state&&(e.data.rows?t.wtList=e.data.rows:t.wtList=[],t.total=e.data.records)})},validate:function(){return/^[+]{0,1}(\d+)$|^[+]{0,1}(\d+\.\d+)$/.test(this.form.gs)||1!=this.form.sfcl?!(!this.form.cljg&&1==this.form.sfcl)||(this.$alert("请输入处理结果!","提示",{confirmButtonText:"确定",type:"warning"}),!1):(this.$alert("请输入正确工时","提示",{confirmButtonText:"确定",type:"warning"}),!1)}},props:{show:{type:Boolean,default:!1},rowData:{type:Object,default:function(){return{}}}},watch:{show:function(t,e){this.visible=this.show,this.isJZuser=sessionStorage.getItem("isJZuser"),t?this.pageActiveServiceProblem():this.form.cljg=""}},components:{}}),c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{attrs:{title:"问题处理",width:"700px",top:"30px",visible:t.visible,"append-to-body":!0,"close-on-click-modal":!1,show:t.show},on:{"update:visible":function(e){t.visible=e},close:function(e){t.$emit("update:show",!1)}}},[i("div",{staticClass:"dialog-wtdj"},t._l(t.wtList,function(e,s){return i("div",{key:s,staticClass:"option-list",attrs:{title:"点击处理风险"},on:{click:function(i){t.handleCommitwtdj(e)}}},[i("p",[i("span",{staticClass:"filter-weight"},[t._v(t._s(e.cpmc)+"　"+t._s(e.fwnr))])]),t._v(" "),i("p",[i("span",{staticClass:"filter-weight"},[t._v("风险描述  ")]),t._v(" "),i("span",{staticStyle:{color:"#f00"}},[t._v(t._s(e.wtms))])]),t._v(" "),i("p",[i("span",{staticClass:"filter-weight"},[t._v("处理建议  ")]),t._v(" "),i("span",{staticStyle:{color:"green"}},[t._v(t._s(e.clyj))])]),t._v(" "),0==t.isJZuser?i("p",[i("span",{staticClass:"filter-weight"},[t._v("问题工时  ")]),t._v(" "),i("span",{staticStyle:{color:"green"}},[t._v(t._s(e.gs))])]):t._e(),t._v(" "),i("p",[i("span",{staticClass:"filter-weight"},[t._v("处理时间  ")]),t._v(" "),i("span",{staticStyle:{color:"green"}},[t._v(t._s(e.clsj))]),t._v("\n\t\t\t\t\t　\n\t\t\t\t\t"),i("span",{staticClass:"filter-weight"},[t._v("处理结果  ")]),t._v(" "),i("span",{staticStyle:{color:"green"}},[t._v(t._s(e.cljg))])]),t._v(" "),i("div",{class:{"wtdj-badge":!0,wt_ycl:"1"==e.zt}},[t._v(t._s("0"==e.zt?"待处理":"1"==e.zt?"已处理":"无需处理"))])])})),t._v(" "),i("div",{attrs:{"text-right":""}},[i("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:"prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e}}})],1),t._v(" "),i("div",{staticStyle:{padding:"15px 30px"},attrs:{"text-right":""}},[i("el-button",{attrs:{size:"mini"},on:{click:t.handleClose}},[t._v("关闭")])],1)]),t._v(" "),i("el-dialog",{attrs:{title:"提交问题",visible:t.dialogVisible,width:"700px",top:"30px","append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px",size:"mini"}},[i("el-form-item",{attrs:{label:"是否已处理",required:""}},[i("el-radio-group",{model:{value:t.form.sfcl,callback:function(e){t.$set(t.form,"sfcl",e)},expression:"form.sfcl"}},[i("el-radio",{attrs:{label:1}},[t._v("已处理")]),t._v(" "),i("el-radio",{attrs:{label:2}},[t._v("无需处理")])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"处理工时",required:1==t.form.sfcl}},[i("el-input",{staticStyle:{width:"90%"},attrs:{type:"text",placeholder:"请输入工时(不能小于0)"},model:{value:t.form.gs,callback:function(e){t.$set(t.form,"gs",e)},expression:"form.gs"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"处理结果",required:1==t.form.sfcl}},[i("el-input",{staticStyle:{width:"90%"},attrs:{type:"textarea",rows:"3",placeholder:"请输入处理结果"},model:{value:t.form.cljg,callback:function(e){t.$set(t.form,"cljg",e)},expression:"form.cljg"}})],1)],1),t._v(" "),i("div",{staticStyle:{padding:"15px 30px"},attrs:{"text-right":""}},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.handleCommit}},[t._v("提 交")]),t._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var h=i("VU/8")(n,c,!1,function(t){i("4Y1v")},"data-v-2f37a329",null).exports,f=(i("oFuF"),{data:function(){return{wtShow:!1,tbfwShow:!1,qrbhfwShow:!1,fxdjShow:!1,title:"",currentPage:1,pageSize:10,total:0,tableData:[],multipleSelection:[],widsArr:[],wids:"",cpobj:{},rowsData:"",filterData:{keyword:"",fwnr:"",cpbh:"",cpmc:"",fwzt:"",lb:"",xmzt:"",jhksrq:"",jhjsrq:"",sfgq:"",fxdj:"",wtzt:"",fxzt:"",ismine:"1"},isJzuser:"",userGroupTag:"",username:"",rowData:{},isMultiple:!1}},methods:{handleCheck:function(t){this.rowData=t,this.fxdjShow=!this.fxdjShow},handleCheckWt:function(t){this.rowData=t,this.wtShow=!this.wtShow},handleSave:function(t){var e=this;this.$post(this.API.submitActiveServiceRisk,{wid:this.rowData.wid,cljg:t.cljg,sfcl:t.sfcl,fjData:t.fileList}).then(function(t){"success"==t.state?(e.$message({message:"保存成功~",type:"success"}),e.fxdjShow=!1,e.pageActiveService()):e.$alert(t.msg,"提示",{confirmButtonText:"确定",type:"error"})})},handleChangeFilter:function(t){this.filterData=t,this.currentPage=1,this.pageActiveService()},handleCommitTB:function(t){var e=this;this.$post(this.API.submitActiveService,{wids:this.wids,sm:t.sm,xjgs:t.xjgs,fjData:t.fileList,sjjsrq:t.sjjsrq}).then(function(t){"success"==t.state?(e.$message({message:"提报成功~",type:"success"}),e.tbfwShow=!1,e.pageActiveService()):e.$alert(t.msg,"提示",{confirmButtonText:"确定",type:"error"})})},handleCommitQR:function(t){var e=this,i={wids:this.wids,sm:t.sm};"确认服务"==this.title&&(i.pf=t.pf?t.pf:""),this.$post("确认服务"==this.title?this.API.confirmActiveService:this.API.rejectActiveService,i).then(function(t){"success"==t.state?(e.$message({message:"确认服务~"==e.title?"确认成功~":"驳回成功~",type:"success"}),e.qrbhfwShow=!1,e.pageActiveService()):e.$alert(t.msg,"提示",{confirmButtonText:"确定",type:"error"})})},handleSelectionChange:function(t){var e=this;this.widsArr=[],this.multipleSelection=t,1==t.length?this.isMultiple=!0:this.isMultiple=!1,t.forEach(function(t){e.widsArr.push(t.wid)})},handleClick:function(t,e){var i=this;this.wids=e?e.wid:this.widsArr.join(",");var s=[];switch(t){case"tbfw":if(this.rowData=e||this.multipleSelection[0],e&&(this.isMultiple=!0),this.multipleSelection.forEach(function(t){"1"==t.zt&&s.push(t.zt)}),s.length)return void this.$alert('状态为 "已完成" 的服务不能再次提报！',"提示",{confirmButtonText:"确定",type:"warning"});this.tbfwShow=!0;break;case"qrfw":this.qrbhfwShow=!0,this.title="确认服务";break;case"bhfw":if(this.multipleSelection.forEach(function(t){"1"!=t.zt&&s.push(t.zt)}),s.length)return void this.$alert('非 "已完成" 状态的服务不能驳回！',"提示",{confirmButtonText:"确定",type:"warning"});this.title="驳回服务",this.qrbhfwShow=!0;break;case"scjh":if(this.multipleSelection.forEach(function(t){"0"!=t.zt&&s.push(t.zt)}),s.length)return void this.$alert("非计划中服务不能删除！","提示",{confirmButtonText:"确定",type:"warning"});this.$confirm("您确定要删除服务计划么?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.$post(i.API.deleteActiveService,{wids:i.wids}).then(function(t){"success"==t.state&&(i.$message({message:"删除成功~",type:"success"}),i.pageActiveService())})}).catch(function(){});break;case"export":window.open(window.baseurl+"activeservice/exportActiveService.do?cpbh="+this.filterData.cpbh+"&cpmc="+this.filterData.cpmc+"&fwnr="+this.filterData.fwnr+"&zt="+this.filterData.fwzt+"&xmzt="+this.filterData.xmzt+"&jhksrq="+this.filterData.jhksrq+"&jhjsrq="+this.filterData.jhjsrq+"&sfgq="+this.filterData.sfgq+"&keyword="+this.filterData.keyword+"&lb="+this.filterData.lb+"&sffb=1&fxdj="+this.filterData.fxdj+"&wtzt="+this.filterData.wtzt+"&fxzt="+this.filterData.fxzt+"&ismine="+this.filterData.ismine);break;case"sc":this.$confirm("您确定要生成服务吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){}).catch(function(){})}},handleSizeChange:function(t){this.pageSize=t,this.currentPage=1,this.pageActiveService()},handleCurrentChange:function(t){this.currentPage=t,this.pageActiveService()},handleCheckDetail:function(t){var e=this.$router.resolve({name:"ZdsfwDetail",query:{wid:t.wid}}).href;window.open(e,"_blank")},listXmZdsfwCp:function(){var t=this;this.$get(this.API.listXmZdsfwCp,{xmbh:""}).then(function(e){"success"==e.state&&(e.data?t.cpList=e.data:t.cpList=[])})},listFwnrByCp:function(){var t=this;this.$get(this.API.listFwnrByCp,{cpbh:this.cpbh,cpmc:this.cpmc}).then(function(e){"success"==e.state&&(e.data?t.fwnrList=e.data:t.fwnrList=[])})},pageActiveService:function(){var t=this;this.$get(this.API.pageActiveService,{curPage:this.currentPage,pageSize:this.pageSize,cpbh:this.filterData.cpbh,cpmc:this.filterData.cpmc,fwnr:this.filterData.fwnr,zt:this.filterData.fwzt,lb:this.filterData.lb,xmzt:this.filterData.xmzt,jhksrq:this.filterData.jhksrq,jhjsrq:this.filterData.jhjsrq,sfgq:this.filterData.sfgq,keyword:this.filterData.keyword,sffb:1,fxdj:this.filterData.fxdj,wtzt:this.filterData.wtzt,fxzt:this.filterData.fxzt,ismine:this.filterData.ismine}).then(function(e){"success"==e.state&&(t.tableData=e.data.rows,t.total=e.data.records)})},getFirstDay:function(){var t=(new Date).getFullYear(),e=(new Date).getMonth()+1;return t+"-"+(e=e<10?"0"+e:e)+"-01"}},mounted:function(){this.listXmZdsfwCp(),this.pageActiveService(),this.isJzuser=sessionStorage.isJZuser,this.userGroupTag=JSON.parse(sessionStorage.userInfo).userGroupTag,this.username=JSON.parse(sessionStorage.userInfo).nickName},props:{},components:{tableLayout:a.a,tbfwDialog:l.a,qrbhfwDialog:r.a,zdsfwFilter:s.a,fxdjDialog:o.a,wtDialog:h}}),w={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"myitem-zdsfw"},[i("tableLayout",{staticClass:"zdsfw-content",attrs:{"flex-column":""}},[i("section",{staticStyle:{"border-bottom":"1px solid #EBEEF5"},attrs:{slot:"top",col:"1"},slot:"top"},[i("zdsfwFilter",{attrs:{placeholder:"学校名称/项目名称/项目编号/合同编号"},on:{handleChangeFilter:t.handleChangeFilter}})],1),t._v(" "),i("section",{attrs:{slot:"bottom",col:"2"},slot:"bottom"},[i("section",[i("div",{staticClass:"mb-12",attrs:{flex:"",spacebetween:""}},[i("div",[i("el-button",{attrs:{disabled:!t.multipleSelection.length,type:"primary",size:"mini"},on:{click:function(e){t.handleClick("qrfw")}}},[t._v("确认服务")]),t._v(" "),i("el-button",{attrs:{disabled:!t.multipleSelection.length,type:"danger",size:"mini"},on:{click:function(e){t.handleClick("bhfw")}}},[t._v("驳回服务")])],1),t._v(" "),i("div",[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.handleClick("export")}}},[t._v("导出")])],1)]),t._v(" "),i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark",border:""},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{fixed:"left",type:"selection",width:"55"}}),t._v(" "),i("el-table-column",{attrs:{fixed:"left",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"!=e.row.zt&&"2"!=e.row.zt&&"0"==t.isJzuser&&t.username==e.row.zrrxm?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){t.handleClick("tbfw",e.row)}}},[t._v("提报")]):t._e(),t._v(" "),"1"==e.row.zt&&"1"==t.isJzuser?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){t.handleClick("qrfw",e.row)}}},[t._v("确认")]):t._e(),t._v(" "),"1"!=e.row.zt||!t.userGroupTag.includes("ZDSFWGLY")&&e.row.jffzrxm!=t.username?t._e():i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){t.handleClick("bhfw",e.row)}}},[t._v("驳回")]),t._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){t.handleCheckDetail(e.row)}}},[t._v("详情")])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"yh",label:"学校名称","min-width":"200","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"cpmc",label:"产品","min-width":"240","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"fwnr",label:"服务内容","min-width":"160","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"zrrxm",label:"责任人",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{label:"服务状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tag",{attrs:{size:"mini",type:"0"==e.row.zt?"primary":"1"==e.row.zt?"success":"danger"}},[t._v(t._s("0"==e.row.zt?"计划中":1==e.row.zt?"完成待确认":3==e.row.zt?"已驳回":"关闭"))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"jhksrq",label:"计划开始日期",width:"150"}}),t._v(" "),i("el-table-column",{attrs:{prop:"jhjsrq",label:"计划结束日期",width:"150"}}),t._v(" "),i("el-table-column",{attrs:{prop:"tbrxm",label:"提报人",width:"100","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"tbsj",label:"提报时间",width:"160","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"sfgq",label:"是否过期",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tag",{attrs:{size:"mini",type:"0"==e.row.sfgq?"primary":"danger"}},[t._v(t._s("0"==e.row.sfgq?"未过期":"1"==e.row.sfgq?"过期":"超期完成"))])]}}])}),t._v(" "),"0"==t.isJzuser?i("el-table-column",{attrs:{prop:"xjgs",label:"巡检工时(小时)",width:"120"}}):t._e(),t._v(" "),"0"==t.isJzuser?i("el-table-column",{attrs:{prop:"fxgs",label:"风险工时(小时)",width:"120"}}):t._e(),t._v(" "),"0"==t.isJzuser?i("el-table-column",{attrs:{prop:"wtgs",label:"问题工时(小时)",width:"120"}}):t._e(),t._v(" "),i("el-table-column",{attrs:{prop:"sjjsrq",label:"实际结束日期",width:"150"}}),t._v(" "),i("el-table-column",{attrs:{prop:"xmbh",label:"项目编号","min-width":"100","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"htbh",label:"合同编号","min-width":"100","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"xmmc",label:"项目名称","min-width":"280","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"xmlb",label:"项目类别","min-width":"80","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"sfzt",label:"合同性质","min-width":"80","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"sfgx",label:"是否购销","min-width":"80","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"dkl",label:"到款率","min-width":"80","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"qrrxm",label:"确认人",width:"100","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"qrsj",label:"确认时间",width:"160","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"pf",label:"评分",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{label:"风险等级(解决情况)",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return["-"!=e.row.fxdj?i("a",{attrs:{href:"javaScript:;;"},on:{click:function(i){t.handleCheck(e.row)}}},[i("el-tag",{class:{"zdsfw-fxdj-s1":1==e.row.fxdj,"zdsfw-fxdj-s2":2==e.row.fxdj,"zdsfw-fxdj-s3":3==e.row.fxdj},attrs:{size:"mini"}},[t._v(t._s(1==e.row.fxdj?"S1":2==e.row.fxdj?"S2":"S3"))]),t._v(" \n              ")],1):t._e(),t._v(" "),"-"==e.row.fxdj?i("span",[t._v(t._s(e.row.fxdj))]):t._e(),t._v(" "),i("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(0==e.row.fxsfcl?"(待处理)":1==e.row.fxsfcl?"(已处理)":""))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"问题总数",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"!=e.row.wtzs&&"-"!=e.row.wtzs?i("a",{attrs:{href:"javaScript:;;"},on:{click:function(i){t.handleCheckWt(e.row)}}},[t._v("\n                "+t._s(e.row.wtzs)+"\n              ")]):t._e(),t._v(" "),"-"!=e.row.wtzs&&"0"!=e.row.wtzs&&e.row.wtzs?t._e():i("span",[t._v("- -")]),t._v(" "),"0"!=e.row.wtzs&&"-"!=e.row.wtzs?i("span",{staticStyle:{"font-size":"12px"}},[t._v("("+t._s(e.row.wtsfcl)+")")]):t._e()]}}])})],1)],1),t._v(" "),i("div",{staticStyle:{"margin-top":"2px"},attrs:{"text-right":""}},[i("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,30,50,100],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)])]),t._v(" "),i("tbfwDialog",{attrs:{show:t.tbfwShow,wids:t.wids,isMultiple:t.isMultiple,rowData:t.rowData},on:{"update:show":function(e){t.tbfwShow=e},handleCommitTB:t.handleCommitTB}}),t._v(" "),i("qrbhfwDialog",{attrs:{show:t.qrbhfwShow,title:t.title},on:{"update:show":function(e){t.qrbhfwShow=e},handleCommitQR:t.handleCommitQR}}),t._v(" "),i("fxdjDialog",{attrs:{show:t.fxdjShow,rowData:t.rowData},on:{"update:show":function(e){t.fxdjShow=e},handleSave:t.handleSave}}),t._v(" "),i("wtDialog",{attrs:{show:t.wtShow,rowData:t.rowData},on:{"update:show":function(e){t.wtShow=e},handleSave:t.handleSave}})],1)},staticRenderFns:[]};var p=i("VU/8")(f,w,!1,function(t){i("1+WS")},"data-v-0dd4ba6d",null);e.default=p.exports}});
//# sourceMappingURL=56.1fadbd1317672952c4a1.js.map